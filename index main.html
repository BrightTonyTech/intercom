<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>InterTask â€” Trac Network Task Board</title>
  <style>
    :root {
      --bg: #0d0d0f;
      --surface: #17181c;
      --surface2: #21222a;
      --border: #2a2b35;
      --accent: #7c5cfc;
      --accent2: #4cc9f0;
      --green: #3ddc97;
      --red: #f05564;
      --yellow: #f5c842;
      --text: #e8e8f0;
      --muted: #6b6c7e;
      --radius: 10px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', system-ui, sans-serif;
      font-size: 14px;
      display: flex;
      flex-direction: column;
      height: 100dvh;
      overflow: hidden;
    }

    /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    header {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-shrink: 0;
    }

    .logo {
      width: 32px; height: 32px;
      background: var(--accent);
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      font-weight: 900; font-size: 18px;
      flex-shrink: 0;
    }

    .header-text { flex: 1; min-width: 0; }
    header h1 { font-size: 16px; font-weight: 700; }
    header p  { font-size: 11px; color: var(--muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    .header-right { display: flex; align-items: center; gap: 8px; margin-left: auto; flex-shrink: 0; }

    .status-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      background: var(--muted);
      transition: background 0.3s;
    }
    .status-dot.connected { background: var(--green); }

    .peer-id {
      font-size: 11px;
      color: var(--muted);
      font-family: monospace;
      max-width: 140px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Hamburger & chat toggle */
    .icon-btn {
      background: none;
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 7px;
      width: 34px; height: 34px;
      display: none;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 16px;
      flex-shrink: 0;
    }

    /* â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .layout {
      display: flex;
      flex: 1;
      overflow: hidden;
      position: relative;
    }

    /* â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    aside {
      width: 220px;
      background: var(--surface);
      border-right: 1px solid var(--border);
      padding: 16px 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex-shrink: 0;
      transition: transform 0.25s ease;
    }

    aside h3 {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      margin-bottom: 4px;
      padding: 0 8px;
    }

    .nav-btn {
      background: none;
      border: none;
      color: var(--text);
      padding: 8px 12px;
      border-radius: 7px;
      cursor: pointer;
      text-align: left;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background 0.15s;
      width: 100%;
    }
    .nav-btn:hover { background: var(--surface2); }
    .nav-btn.active { background: var(--accent); color: #fff; }

    .badge {
      margin-left: auto;
      background: var(--surface2);
      border-radius: 20px;
      padding: 1px 7px;
      font-size: 11px;
      color: var(--muted);
      min-width: 22px;
      text-align: center;
    }
    .nav-btn.active .badge { background: rgba(255,255,255,0.2); color: #fff; }

    /* Sidebar close btn (mobile) */
    .sidebar-close {
      display: none;
      background: none;
      border: none;
      color: var(--muted);
      font-size: 18px;
      cursor: pointer;
      margin-left: auto;
      padding: 4px 8px;
    }

    /* â”€â”€ Main â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      min-width: 0;
    }

    .toolbar {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
      flex-wrap: wrap;
      flex-shrink: 0;
    }

    .toolbar h2 { font-size: 15px; font-weight: 600; }

    .toolbar-actions { margin-left: auto; display: flex; gap: 8px; align-items: center; }

    .btn {
      padding: 7px 14px;
      border-radius: 7px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: opacity 0.15s;
      white-space: nowrap;
    }
    .btn:hover { opacity: 0.85; }
    .btn-primary { background: var(--accent); color: #fff; }
    .btn-ghost { background: var(--surface2); color: var(--text); border: 1px solid var(--border); }

    /* â”€â”€ Stats bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .stats-bar {
      display: flex;
      gap: 2px;
      padding: 0 16px;
      height: 4px;
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }

    .stats-seg {
      height: 4px;
      transition: width 0.4s ease;
    }

    .seg-open { background: var(--accent2); }
    .seg-done { background: var(--green); }
    .seg-cancelled { background: var(--muted); }

    /* â”€â”€ Task list â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .task-list {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .task-list::-webkit-scrollbar { width: 5px; }
    .task-list::-webkit-scrollbar-track { background: transparent; }
    .task-list::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }

    .task-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 14px 16px;
      cursor: pointer;
      transition: border-color 0.15s, background 0.15s;
    }
    .task-card:hover {
      border-color: var(--accent);
      background: var(--surface2);
    }

    .task-header {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      flex-wrap: wrap;
    }

    .task-id {
      font-family: monospace;
      font-size: 11px;
      color: var(--muted);
      padding-top: 2px;
      min-width: 60px;
      flex-shrink: 0;
    }

    .task-title {
      flex: 1;
      font-weight: 600;
      font-size: 14px;
      line-height: 1.4;
      min-width: 120px;
    }

    .status-pill {
      padding: 2px 9px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      flex-shrink: 0;
    }
    .status-open      { background: rgba(76,201,240,0.15); color: var(--accent2); }
    .status-completed { background: rgba(61,220,151,0.15); color: var(--green); }
    .status-cancelled { background: rgba(240,85,100,0.15); color: var(--red); }

    .task-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 16px;
      margin-top: 8px;
      font-size: 12px;
      color: var(--muted);
    }

    .task-desc {
      margin-top: 6px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.5;
    }

    .task-actions {
      display: flex;
      gap: 6px;
      margin-top: 10px;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
    }
    .empty-state h3 { font-size: 16px; margin-bottom: 6px; color: var(--text); }

    /* â”€â”€ Chat panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .chat-panel {
      width: 280px;
      border-left: 1px solid var(--border);
      background: var(--surface);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      transition: transform 0.25s ease;
    }

    .chat-header {
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      font-weight: 600;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .chat-close {
      display: none;
      background: none;
      border: none;
      color: var(--muted);
      font-size: 18px;
      cursor: pointer;
      margin-left: auto;
      padding: 2px 6px;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .chat-messages::-webkit-scrollbar { width: 4px; }
    .chat-messages::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }

    .chat-msg {
      background: var(--surface2);
      border-radius: 8px;
      padding: 8px 10px;
    }

    .chat-msg .from {
      font-size: 10px;
      color: var(--accent);
      font-family: monospace;
      margin-bottom: 3px;
    }
    .chat-msg.system .from { color: var(--yellow); }
    .chat-msg .text { font-size: 12px; line-height: 1.45; }

    .chat-input-row {
      display: flex;
      gap: 6px;
      padding: 10px;
      border-top: 1px solid var(--border);
    }

    .chat-input-row input {
      flex: 1;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 7px;
      color: var(--text);
      padding: 7px 10px;
      font-size: 12px;
      outline: none;
      min-width: 0;
    }
    .chat-input-row input:focus { border-color: var(--accent); }

    .chat-input-row button {
      background: var(--accent);
      border: none;
      border-radius: 7px;
      color: #fff;
      padding: 7px 12px;
      cursor: pointer;
      font-size: 12px;
      flex-shrink: 0;
    }

    /* â”€â”€ Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.65);
      z-index: 100;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }
    .modal-overlay.open { display: flex; }

    .modal {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 24px;
      width: 460px;
      max-width: 100%;
      max-height: 90dvh;
      overflow-y: auto;
    }

    .modal h3 { font-size: 16px; margin-bottom: 18px; }

    .field { margin-bottom: 14px; }
    .field label { display: block; font-size: 12px; color: var(--muted); margin-bottom: 5px; }
    .field input,
    .field textarea {
      width: 100%;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 7px;
      color: var(--text);
      padding: 9px 12px;
      font-size: 13px;
      outline: none;
      resize: vertical;
      font-family: inherit;
    }
    .field input:focus,
    .field textarea:focus { border-color: var(--accent); }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    /* Overlay for sidebar/chat on mobile */
    .drawer-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 50;
    }
    .drawer-overlay.show { display: block; }

    /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 900px) {
      .chat-panel {
        position: fixed;
        top: 0; right: 0; bottom: 0;
        z-index: 60;
        transform: translateX(100%);
        width: 300px;
        max-width: 85vw;
      }
      .chat-panel.open { transform: translateX(0); }
      .chat-close { display: block; }
      .icon-btn { display: flex; }
    }

    @media (max-width: 640px) {
      aside {
        position: fixed;
        top: 0; left: 0; bottom: 0;
        z-index: 60;
        transform: translateX(-100%);
        width: 240px;
      }
      aside.open { transform: translateX(0); }
      .sidebar-close { display: block; }

      .peer-id { display: none; }

      .toolbar { padding: 10px 12px; }
      .task-list { padding: 12px; }

      .task-meta { flex-direction: column; gap: 4px; }

      .modal { padding: 20px 16px; }
      .modal-actions { justify-content: stretch; }
      .modal-actions .btn { flex: 1; text-align: center; }
    }
  </style>
</head>
<body>

<header>
  <button class="icon-btn" id="menuBtn" aria-label="Toggle menu" onclick="toggleSidebar()">â˜°</button>
  <div class="logo">âœ“</div>
  <div class="header-text">
    <h1>InterTask</h1>
    <p>Trac Network Â· Decentralized Task Board</p>
  </div>
  <div class="header-right">
    <span class="peer-id" id="peerId">connectingâ€¦</span>
    <div class="status-dot" id="statusDot"></div>
    <button class="icon-btn" id="chatBtn" aria-label="Toggle chat" onclick="toggleChat()">ğŸ’¬</button>
  </div>
</header>

<!-- Drawer overlay (closes sidebar or chat on mobile) -->
<div class="drawer-overlay" id="drawerOverlay" onclick="closeDrawers()"></div>

<div class="layout">

  <!-- Sidebar -->
  <aside id="sidebar">
    <div style="display:flex;align-items:center;padding:0 4px 8px;">
      <h3 style="margin:0;padding:0;">Filter</h3>
      <button class="sidebar-close" onclick="toggleSidebar()" aria-label="Close sidebar">âœ•</button>
    </div>
    <button class="nav-btn active" onclick="setFilter('all', this)">
      ğŸ“‹ All Tasks <span class="badge" id="cnt-all">0</span>
    </button>
    <button class="nav-btn" onclick="setFilter('open', this)">
      ğŸ”µ Open <span class="badge" id="cnt-open">0</span>
    </button>
    <button class="nav-btn" onclick="setFilter('completed', this)">
      âœ… Completed <span class="badge" id="cnt-completed">0</span>
    </button>
    <button class="nav-btn" onclick="setFilter('cancelled', this)">
      âŒ Cancelled <span class="badge" id="cnt-cancelled">0</span>
    </button>

    <h3 style="margin-top:16px">Assigned to me</h3>
    <button class="nav-btn" onclick="setFilter('mine', this)">
      ğŸ‘¤ My Tasks <span class="badge" id="cnt-mine">0</span>
    </button>
  </aside>

  <!-- Main content -->
  <main>
    <div class="toolbar">
      <h2 id="viewTitle">All Tasks</h2>
      <div class="toolbar-actions">
        <button class="btn btn-primary" onclick="openNewTaskModal()">+ New Task</button>
      </div>
    </div>

    <div class="stats-bar">
      <div class="stats-seg seg-open"  id="seg-open"  style="width:33%"></div>
      <div class="stats-seg seg-done"  id="seg-done"  style="width:33%"></div>
      <div class="stats-seg seg-cancelled" id="seg-cancelled" style="width:34%"></div>
    </div>

    <div class="task-list" id="taskList">
      <div class="empty-state">
        <h3>No tasks yet</h3>
        <p>Create your first task to get started.</p>
      </div>
    </div>
  </main>

  <!-- Chat panel -->
  <div class="chat-panel" id="chatPanel">
    <div class="chat-header">
      ğŸ’¬ Sidechannel Chat
      <button class="chat-close" onclick="toggleChat()" aria-label="Close chat">âœ•</button>
    </div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input-row">
      <input type="text" id="chatInput" placeholder="Send a messageâ€¦" onkeydown="if(event.key==='Enter') sendChat()" />
      <button onclick="sendChat()">Send</button>
    </div>
  </div>

</div>

<!-- New Task Modal -->
<div class="modal-overlay" id="newTaskModal" onclick="handleOverlayClick(event)">
  <div class="modal">
    <h3>Create New Task</h3>
    <div class="field">
      <label>Title *</label>
      <input id="newTitle" type="text" placeholder="What needs to be done?" maxlength="140" />
    </div>
    <div class="field">
      <label>Description</label>
      <textarea id="newDesc" rows="3" placeholder="Optional detailsâ€¦"></textarea>
    </div>
    <div class="field">
      <label>Assign to (peer address)</label>
      <input id="newAssignee" type="text" placeholder="Optional peer address" />
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="submitNewTask()">Create Task</button>
    </div>
  </div>
</div>

<script>
// â”€â”€â”€ Local task store â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ME = 'local-user'
let tasks = []
let nextId = 1
let currentFilter = 'all'

function genId () { return 'TASK-' + String(nextId++).padStart(4, '0') }

// â”€â”€â”€ Boot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function boot () {
  document.getElementById('peerId').textContent = 'local mode'
  document.getElementById('statusDot').classList.add('connected')
  addChatMsg('system', 'sys', 'Running in local mode â€” tasks are stored in memory.')
  renderAll()
}

// â”€â”€â”€ Tasks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getFiltered () {
  if (currentFilter === 'all')    return tasks
  if (currentFilter === 'mine')   return tasks.filter(t => t.assignee === ME || t.creator === ME)
  return tasks.filter(t => t.status === currentFilter)
}

function renderAll () {
  const open      = tasks.filter(t => t.status === 'open').length
  const completed = tasks.filter(t => t.status === 'completed').length
  const cancelled = tasks.filter(t => t.status === 'cancelled').length
  const total     = tasks.length || 1

  document.getElementById('cnt-all').textContent       = tasks.length
  document.getElementById('cnt-open').textContent      = open
  document.getElementById('cnt-completed').textContent = completed
  document.getElementById('cnt-cancelled').textContent = cancelled
  document.getElementById('cnt-mine').textContent      =
    tasks.filter(t => t.assignee === ME || t.creator === ME).length

  const w = n => Math.max(1, Math.round((n / total) * 100)) + '%'
  document.getElementById('seg-open').style.width      = w(open)
  document.getElementById('seg-done').style.width      = w(completed)
  document.getElementById('seg-cancelled').style.width = w(cancelled)

  renderTasks(getFiltered())
}

function renderTasks (list) {
  const el = document.getElementById('taskList')
  if (!list.length) {
    el.innerHTML = `<div class="empty-state"><h3>No tasks here</h3><p>Change the filter or create a new task.</p></div>`
    return
  }
  el.innerHTML = list.map(t => {
    const assignee = t.assignee || 'Unassigned'
    const date     = new Date(t.created_at).toLocaleDateString()
    const isOpen   = t.status === 'open'
    return `
    <div class="task-card">
      <div class="task-header">
        <span class="task-id">${t.id}</span>
        <span class="task-title">${escHtml(t.title)}</span>
        <span class="status-pill status-${t.status}">${t.status}</span>
      </div>
      ${t.desc ? `<div class="task-desc">${escHtml(t.desc.slice(0, 120))}${t.desc.length > 120 ? 'â€¦' : ''}</div>` : ''}
      <div class="task-meta">
        <span>ğŸ‘¤ ${escHtml(assignee)}</span>
        <span>ğŸ“… ${date}</span>
      </div>
      ${isOpen ? `
      <div class="task-actions">
        <button class="btn btn-ghost" style="padding:4px 12px;font-size:12px;"
          onclick="completeTask('${t.id}')">âœ” Complete</button>
        <button class="btn btn-ghost" style="padding:4px 12px;font-size:12px;color:var(--red);"
          onclick="cancelTask('${t.id}')">âœ• Cancel</button>
      </div>` : ''}
    </div>`
  }).join('')
}

// â”€â”€â”€ Task actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.completeTask = function (id) {
  const t = tasks.find(t => t.id === id)
  if (t) { t.status = 'completed'; renderAll() }
}

window.cancelTask = function (id) {
  if (!confirm('Cancel this task?')) return
  const t = tasks.find(t => t.id === id)
  if (t) { t.status = 'cancelled'; renderAll() }
}

// â”€â”€â”€ New task modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.openNewTaskModal = function () {
  document.getElementById('newTaskModal').classList.add('open')
  setTimeout(() => document.getElementById('newTitle').focus(), 50)
}

window.closeModal = function () {
  document.getElementById('newTaskModal').classList.remove('open')
}

window.handleOverlayClick = function (e) {
  if (e.target === document.getElementById('newTaskModal')) closeModal()
}

window.submitNewTask = function () {
  const titleEl    = document.getElementById('newTitle')
  const descEl     = document.getElementById('newDesc')
  const assigneeEl = document.getElementById('newAssignee')

  const title    = titleEl.value.trim()
  const desc     = descEl.value.trim()
  const assignee = assigneeEl.value.trim() || null

  if (!title) {
    titleEl.focus()
    titleEl.style.borderColor = 'var(--red)'
    setTimeout(() => titleEl.style.borderColor = '', 1500)
    return
  }

  tasks.unshift({
    id: genId(),
    title,
    desc,
    assignee,
    creator: ME,
    status: 'open',
    created_at: Date.now()
  })

  titleEl.value = ''
  descEl.value = ''
  assigneeEl.value = ''
  closeModal()
  renderAll()
}

// Allow Enter key to submit from the title field
document.getElementById('newTitle').addEventListener('keydown', e => {
  if (e.key === 'Enter') window.submitNewTask()
})

// â”€â”€â”€ Filter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.setFilter = function (filter, btn) {
  currentFilter = filter
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'))
  btn.classList.add('active')
  const titles = { all: 'All Tasks', open: 'Open Tasks', completed: 'Completed', cancelled: 'Cancelled', mine: 'My Tasks' }
  document.getElementById('viewTitle').textContent = titles[filter]
  renderAll()
  if (window.innerWidth <= 640) closeDrawers()
}

// â”€â”€â”€ Chat (local only) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.sendChat = function () {
  const input = document.getElementById('chatInput')
  const text = input.value.trim()
  if (!text) return
  addChatMsg('me', 'me', text)
  input.value = ''
}

document.getElementById('chatInput').addEventListener('keydown', e => {
  if (e.key === 'Enter') window.sendChat()
})

function addChatMsg (cls, from, text) {
  const box = document.getElementById('chatMessages')
  const div = document.createElement('div')
  div.className = `chat-msg ${cls}`
  div.innerHTML = `<div class="from">${escHtml(from)}</div><div class="text">${escHtml(text)}</div>`
  box.appendChild(div)
  box.scrollTop = box.scrollHeight
}

function escHtml (s) {
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')
}

// â”€â”€â”€ Drawer toggles â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.toggleSidebar = function () {
  const sidebar = document.getElementById('sidebar')
  const overlay = document.getElementById('drawerOverlay')
  const isOpen = sidebar.classList.toggle('open')
  overlay.classList.toggle('show', isOpen)
  if (isOpen) document.getElementById('chatPanel').classList.remove('open')
}

window.toggleChat = function () {
  const chat = document.getElementById('chatPanel')
  const overlay = document.getElementById('drawerOverlay')
  const isOpen = chat.classList.toggle('open')
  overlay.classList.toggle('show', isOpen)
  if (isOpen) document.getElementById('sidebar').classList.remove('open')
}

window.closeDrawers = function () {
  document.getElementById('sidebar').classList.remove('open')
  document.getElementById('chatPanel').classList.remove('open')
  document.getElementById('drawerOverlay').classList.remove('show')
}

boot()
</script>

</body>
</html>
